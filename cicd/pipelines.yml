# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

pool:
  vmImage: ubuntu-latest

parameters:
- name: name
  displayName: 'name:'
  type: string
  default: 'Mariusz'
- name: sessionId
  displayName:  'sessionId:'
  type: string
  default: '123456789'

jobs:
- job: 'CallFunction'
  pool: server
  steps:
  - task: AzureFunction@1
    displayName: Deployment Request Process
    inputs:
      function: 'https://wvd-scale.azurewebsites.net/api/DeploymentRequestProcess'
      key: '$(functionKey)'
      method: 'POST'
      body: |
        {
        "name":"${{ parameters.name }}",
        "sessionId": "${{ parameters.sessionId }}",
        "wvdPool": "windows",
        "number": 100
        }
      waitForCompletion: 'false'
  - task: AzureFunction@1
    displayName: Deployment Start Process
    inputs:
      function: 'https://wvd-scale.azurewebsites.net/api/DeplymentStartProcess'
      key: '$(functionKey2)'
      method: 'POST'
      body: |
        {
        "sessionId": "${{ parameters.sessionId }}"
        }
      waitForCompletion: 'false'